#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);

foreach (qw(samba/smb.conf))
{
    templates2events("/etc/$_", qw(
	console-save
	bootstrap-console-save
	ibay-create
	ibay-delete
	ibay-modify
	ibay-modify-servers
	network-delete
	network-create
        nethserver-samba-save
	));
}


my $event;

$event = "group-create";
event_link("nethserver-samba-group-create", $event, "30");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "group-delete";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "group-modify";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-create";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-delete";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-modify";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-modify-servers";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "network-create";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "network-delete";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "user-create";
event_link("nethserver-samba-user-create", $event, "20");
event_link("nethserver-samba-profile-create", $event, "25");
event_link("nethserver-samba-user-modify", $event, "30");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "user-delete";
event_link("nethserver-samba-profile-delete", $event, "20");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "user-modify";
event_link("nethserver-samba-user-modify", $event, "30");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "nethserver-samba-save";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/nmb");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/winbind");

$event = "printer-create";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "printer-delete";
event_link("delete_printer_tdb", $event, 15);
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "nethserver-samba-machine-create";
event_link("nethserver-samba-machine-create", $event, "10");

$event = "password-modify";
event_link("nethserver-samba-password-modify", $event, "40");

$event = "nethserver-samba-update";
templates2events("/etc/samba/smb.conf", $event);
event_link("initialize-default-databases", $event, "00");
event_link("nethserver-samba-conf", $event, "20");
event_link("nethserver-samba-sam-conf", $event, "95");
event_link("nethserver-samba-user-create", $event, "96");
event_link("nethserver-samba-group-create", $event, "97");

#
# restart daemons on packages update:
#
foreach my $daemon (qw(nmb smb winbind)) {
    foreach my $pkg (qw(base directory samba)) {
	safe_symlink("restart", 
		     "root/etc/e-smith/events/nethserver-$pkg-update/services2adjust/$daemon")
    }	
}


