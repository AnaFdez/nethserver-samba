#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);

foreach (qw(samba/smb.conf))
{
    templates2events("/etc/$_", qw(
	console-save
	bootstrap-console-save
	ibay-create
	ibay-delete
	ibay-modify
	ibay-modify-servers
	network-delete
	network-create
	workgroup-update
	));
}

#foreach my $file (qw(
#	/etc/pam.d/samba
#	))
#{
#    templates2events($file, qw(console-save bootstrap-console-save));
#}

my $event = "console-save";

$event = "bootstrap-console-save";
event_link("update-domain-group-maps", $event, "56");
event_link("samba-update-smbpasswd", $event, "20");
event_link("nethserver-samba-profile-create", $event, "30");

$event = "group-create";
event_link("update-domain-group-maps", $event, "56");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "group-delete";
event_link("update-domain-group-maps", $event, "14");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "group-modify";
event_link("update-domain-group-maps", $event, "56");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-create";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-delete";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-modify";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "ibay-modify-servers";
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "network-create";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "network-delete";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "user-create";
event_link("nethserver-samba-profile-create", $event, "20");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "user-delete";
event_link("nethserver-samba-profile-delete", $event, "20");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "user-modify";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "workgroup-update";
event_link("samba-update-smbpasswd", $event, "25");
event_link("update-domain-group-maps", $event, "56");
safe_symlink("sigterm", "root/etc/e-smith/events/$event/services2adjust/dhcpd");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/nmb");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/winbind");
# templates2events("/etc/krb5.conf", $event);

$event = "printer-create";
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "printer-delete";
event_link("delete_printer_tdb", $event, 15);
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/smb");

$event = "nethserver-samba-machine-create";
event_link("nethserver-samba-machine-create", $event, "10");

$event = "password-modify";
event_link("nethserver-samba-password-modify", $event, "40");

$event = "nethserver-samba-update";
templates2events("/etc/samba/smb.conf", $event);
# templates2events("/etc/krb5.conf", $event);
event_link("initialize-default-databases", $event, "00");
event_link("nethserver-samba-conf", $event, "20");

#
# restart daemons on package update:
#
foreach my $daemon (qw(nmb smb winbind)) {
    foreach my $pkg (qw(base directory samba)) {
	safe_symlink("restart", 
		     "root/etc/e-smith/events/nethserver-$pkg-update/services2adjust/$daemon")
    }	
}


